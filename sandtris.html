<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>サンドトリス</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
    font-family: Arial, sans-serif;
  }
  #gameBoard {
    position: relative;
    width: 300px;
    height: 500px;
    background-color: #fff;
    border: 2px solid #000;
  }
  .block {
    position: absolute;
    width: 30px;
    height: 30px;
  }
  #scoreBoard {
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 24px;
  }
</style>
</head>
<body>
<div id="gameBoard">
  <div id="scoreBoard">スコア: 0</div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const board = document.getElementById('gameBoard');
    const scoreBoard = document.getElementById('scoreBoard');
    const colors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#9400d3']; // 7色
    let block = null;
    let interval = null;
    let score = 0;
    let rotation = 0;

    function updateScore() {
      score += 10;
      scoreBoard.textContent = `スコア: ${score}`;
    }

    function createBlock() {
      block = document.createElement('div');
      block.className = 'block';
      block.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      block.style.top = '0px';
      block.style.left = '120px';
      board.appendChild(block);
    }

    function moveBlock() {
      let top = 0;
      interval = setInterval(() => {
        if (top < 470) {
          top += 30;
          block.style.top = top + 'px';
        } else {
          clearInterval(interval);
          updateScore();
          changeToSand(block);
          createBlock();
          moveBlock();
        }
      }, 500);
    }

    function changeToSand(block) {
      const sand = document.createElement('div');
      sand.className = 'block';
      sand.style.backgroundColor = block.style.backgroundColor;
      sand.style.top = block.style.top;
      sand.style.left = block.style.left;
      sand.classList.add('sand');
      board.removeChild(block);
      board.appendChild(sand);
      applyGravity(sand);
    }

    function applyGravity(sand) {
      let top = parseInt(sand.style.top);
      const gravityInterval = setInterval(() => {
        if (top < 470) {
          top += 30;
          sand.style.top = top + 'px';
        } else {
          clearInterval(gravityInterval);
        }
      }, 500);
    }

    function rotateBlock(direction) {
      rotation += direction;
      block.style.transform = `rotate(${rotation}deg)`;
    }

    function handleKeyPress(e) {
      const left = parseInt(block.style.left);
      if (e.key === 'ArrowLeft' && left > 0) {
        block.style.left = left - 30 + 'px';
      } else if (e.key === 'ArrowRight' && left < 270) {
        block.style.left = left + 30 + 'px';
      } else if (e.key === 'w' || e.key === 'W') {
        rotateBlock(90); // 右回転
      } else if (e.key === 'q' || e.key === 'Q') {
        rotateBlock(-90); // 左回転
      }
    }

    document.addEventListener('keydown', handleKeyPress);

    createBlock();
    moveBlock();
  });
</script>
</body>
</html>
